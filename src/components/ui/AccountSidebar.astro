---
// src/components/ui/AccountSidebar.astro
interface Props {
  active: 'perfil' | 'pedidos' | 'direcciones';
}

const { active } = Astro.props;
---

<div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
  <h2 class="text-base md:text-lg font-serif font-bold text-charcoal-900 mb-4 md:mb-6">Mi Cuenta</h2>
  <nav class="flex md:flex-col overflow-x-auto md:overflow-x-visible pb-2 md:pb-0 gap-4 md:gap-4 no-scrollbar">
    <a 
      href="/mi-cuenta/perfil" 
      class={`whitespace-nowrap text-xs md:text-sm transition-colors flex-shrink-0 ${
        active === 'perfil' 
          ? 'text-red-600 font-medium border-b-2 md:border-b-0 md:border-l-2 border-red-600 pb-1 md:pb-0 md:pl-3' 
          : 'text-charcoal-600 hover:text-red-600 md:pl-3'
      }`}
    >
      Perfil
    </a>
    <a 
      href="/mi-cuenta/pedidos" 
      class={`whitespace-nowrap text-xs md:text-sm transition-colors flex-shrink-0 ${
        active === 'pedidos' 
          ? 'text-red-600 font-medium border-b-2 md:border-b-0 md:border-l-2 border-red-600 pb-1 md:pb-0 md:pl-3' 
          : 'text-charcoal-600 hover:text-red-600 md:pl-3'
      }`}
    >
      Mis Pedidos
    </a>
    <a 
      href="/mi-cuenta/direcciones" 
      class={`whitespace-nowrap text-xs md:text-sm transition-colors flex-shrink-0 ${
        active === 'direcciones' 
          ? 'text-red-600 font-medium border-b-2 md:border-b-0 md:border-l-2 border-red-600 pb-1 md:pb-0 md:pl-3' 
          : 'text-charcoal-600 hover:text-red-600 md:pl-3'
      }`}
    >
      Mis Direcciones
    </a>
    <button 
      id="logout-btn-sidebar" 
      class="whitespace-nowrap pb-1 md:pb-0 text-left text-red-600 hover:text-red-800 transition-colors text-xs md:text-sm md:pl-3 font-medium flex-shrink-0"
    >
      Cerrar Sesi√≥n
    </button>
  </nav>
</div>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  import { clearCartOnLogout } from '@/stores/cart';

  // Logout Sidebar
  document.getElementById('logout-btn-sidebar')?.addEventListener('click', async () => {
    try {
      await fetch('/api/auth/logout', { method: 'POST' });
      await clearCartOnLogout();
    } catch (error) {
      console.error('Error during logout:', error);
    }
    window.location.href = '/';
  });
</script>
